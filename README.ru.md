[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/nalivayev/florentine_abbot/blob/master/README.md)
[![ru](https://img.shields.io/badge/lang-ru-yellow.svg)](https://github.com/nalivayev/florentine_abbot/blob/master/README.ru.md)

# Florentine Abbot

Утилита для автоматизации и оптимизации процесса сканирования с помощью [VueScan](https://www.hamrick.com) от Ed Hamrick.

## Возможности

- **Автоматический расчет оптимального DPI сканирования** на основе параметров фотографии и требований к результату.
- **Пакетная обработка**: интерактивный режим, одиночный расчет или обработка папки.
- **Гибкая система шаблонов** для имен файлов и метаданных, включая извлечение EXIF.
- **Автоматизация workflow**: запуск VueScan с автогенерируемыми настройками, перемещение и переименование файлов, извлечение EXIF-метаданных.
- **Подробное логирование** всех этапов работы.
- **Командная строка** с валидацией аргументов и справкой.

## Основные модули

- `run.py` — основной скрипт для запуска batch-обработки и расчетов.
- `classes/batch.py` — логика batch-режимов и интерактивного расчета DPI.
- `classes/recorder.py` — модуль логирования.
- `classes/vuescan/workflow.py` — автоматизация workflow для VueScan.
- `classes/exifer.py` — извлечение и парсинг EXIF-метаданных.

## Система шаблонов

Шаблоны используются в настройках и именах файлов для подстановки динамических значений.

**Формат шаблона:**

```
{<имя>[:длина[:выравнивание[:заполнитель]]]}
```

- `имя` — имя переменной шаблона  
- `длина` — итоговая длина (необязательно)  
- `выравнивание` — `<`, `>`, `^` (необязательно)  
- `заполнитель` — символ заполнения (необязательно)  

**Пример:**

```
{digitization_year:8:>:0}
```

## Поддерживаемые переменные шаблонов

- `user_name` — имя пользователя операционной системы  
- `digitization_year` — год оцифровки (из EXIF или времени изменения файла)  
- `digitization_month` — месяц оцифровки  
- `digitization_day` — день оцифровки  
- `digitization_hour` — час оцифровки  
- `digitization_minute` — минута оцифровки  
- `digitization_second` — секунда оцифровки  
- `scan_dpi` — значение DPI, выбранное или рассчитанное в ходе пакетной или интерактивной обработки  
- ...а также любые дополнительные переменные, переданные через командную строку (`--templates ключ=значение`) или batch-шаблоны

**Примечание:**  
Если EXIF-метаданные отсутствуют, переменные даты и времени заполняются временем изменения файла.

**Пример:**
```
{digitization_year:8:>:0}
```

## Использование

Запуск основного workflow:

```sh
python run.py --workflow <path_to_ini> --engine vuescan --batch scan --min-dpi 300 --max-dpi 4800 --dpis 600 1200 2400 4800
```

Для получения полного списка аргументов и опций используйте:

```sh
python run.py --help
```

## Логирование

Все этапы работы и ошибки логируются в файл с тем же именем, что и скрипт, и расширением `.log`.

## Установка

Для локальной установки пакета из исходного каталога используйте:

```sh
pip install .
```

Это установит все необходимые зависимости и сделает команду `florentine-abbot` доступной в вашей системе.

> **Примечание:**  
> Рекомендуется использовать [виртуальное окружение](https://docs.python.org/3/library/venv.html) для установки и разработки.

Для обновления уже установленного пакета используйте:

```sh
pip install --upgrade .
```

---

Подробнее см. в [README.md](README.md) (на английском).
