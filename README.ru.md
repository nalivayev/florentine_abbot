[![en](https://img.shields.io/badge/lang-en-red.svg)](https://github.com/nalivayev/florentine_abbot/blob/master/README.md)
[![ru](https://img.shields.io/badge/lang-ru-yellow.svg)](https://github.com/nalivayev/florentine_abbot/blob/master/README.ru.md)

# Florentine Abbot

Утилита для автоматизации и оптимизации процесса сканирования с помощью [VueScan](https://www.hamrick.com) от Ed Hamrick.

## Возможности

- **Автоматический расчёт оптимального DPI сканирования** на основе параметров фотографии и требований к результату.
- **Пакетная обработка**: интерактивный режим, одиночный расчёт или обработка папки.
- **Гибкая система шаблонов** для имён файлов и метаданных, включая извлечение EXIF.
- **Автоматизация рабочего процесса**: запуск VueScan с сгенерированными настройками, перемещение и переименование файлов, извлечение EXIF-метаданных.
- **Подробное логирование** всех этапов работы.
- **Командная строка** с валидацией аргументов и справкой.
- **Плагинная система**: легко расширяйте рабочие процессы, добавляя новые плагины (см. ниже).

## Основные модули

- `scan_batcher/cli.py` — основной CLI-модуль (используется для команды `florentine-abbot`).
- `scan_batcher/batch.py` — логика пакетных и интерактивных расчётов DPI.
- `scan_batcher/calculator.py` — алгоритмы расчёта DPI.
- `scan_batcher/parser.py` — парсинг и валидация аргументов командной строки.
- `scan_batcher/recorder.py` — модуль логирования.
- `scan_batcher/workflow.py` — базовый класс для всех workflow-плагинов.
- `scan_batcher/workflows/__init__.py` — регистрация и обнаружение плагинов.
- `scan_batcher/workflows/vuescan/workflow.py` — автоматизация рабочего процесса VueScan.
- `scan_batcher/exifer.py` — извлечение и обработка EXIF-метаданных.

## Система шаблонов

Шаблоны используются в настройках и именах файлов для подстановки динамических значений.

**Формат шаблона:**

```
{<name>[:length[:align[:pad]]]}
```

- `name` — имя переменной шаблона  
- `length` — итоговая длина (необязательно)  
- `align` — выравнивание (`<`, `>`, `^`; необязательно)  
- `pad` — символ заполнения (необязательно)  

## Поддерживаемые переменные шаблонов

- `user_name` — имя пользователя операционной системы  
- `digitization_year` — год оцифровки (из EXIF или времени изменения файла)  
- `digitization_month` — месяц оцифровки  
- `digitization_day` — день оцифровки  
- `digitization_hour` — час оцифровки  
- `digitization_minute` — минута оцифровки  
- `digitization_second` — секунда оцифровки  
- `scan_dpi` — значение DPI, выбранное или рассчитанное в ходе пакетной или интерактивной обработки  
- ...а также любые дополнительные переменные, переданные через командную строку (`--templates ключ=значение`) или batch-шаблоны

**Примечание:**  
Если EXIF-метаданные отсутствуют, переменные даты и времени заполняются временем изменения файла.

**Пример:**
```
{digitization_year:8:>:0}
```

## Использование

Запуск основного рабочего процесса:

```sh
florentine-abbot --workflow <путь_к_ini> --engine vuescan --batch scan --min-dpi 300 --max-dpi 4800 --dpis 600 1200 2400 4800
```

Для получения полного списка аргументов и опций используйте:

```sh
florentine-abbot --help
```

## Логирование

Все этапы работы и ошибки логируются в файл с тем же именем, что и скрипт, и расширением `.log`.

## Установка

Для локальной установки пакета из исходного каталога используйте:

```sh
pip install .
```

Это установит все необходимые зависимости и сделает команду `florentine-abbot` доступной в вашей системе.

> **Примечание:**  
> Рекомендуется использовать [виртуальное окружение](https://docs.python.org/3/library/venv.html) для установки и разработки.

Для обновления уже установленного пакета используйте:

```sh
pip install --upgrade .
```

---

Для подробностей см. [README.md](README.md) (на английском).
